setwd("~/R/gacki_analiza")
source("functions/observation_split.R")
source("functions/count_instances.R")
source("functions/u_remove.R")
source("functions/bs_remove.R")
source("functions/get_sun.R")
source("functions/wesolowski_plot.R")
library(dplyr)
library(lubridate)
library(ggplot2)
library(lattice)
library(tidyr)
sun <- get_sun("input/wschody_zachody_2012.csv")
sun <- tbl_df(sun)
# WCZYTUJEMY OBIE TABELE
jablow <- read.csv2("input/jablow_calosc.csv", as.is = TRUE)
krajanow <- read.csv2("input/krajanow_calosc.csv", as.is = TRUE)
jablow <- tbl_df(jablow)
krajanow <- tbl_df(krajanow)
calosc <- bind_rows(krajanow, jablow)
rm(jablow)
rm(krajanow)
calosc$Season <- toupper(calosc$Season)
calosc<- separate(calosc,Season, c("kolonia", "Season"), "_")
calosc$Season[calosc$Season == "1"] <- "I"
calosc$Season[calosc$Season == "2"] <- "II"
calosc$Season[calosc$Season == "3"] <- "III"
## Zmieniam daty na format R - patrz lubridate
calosc$Date_time <- dmy_hms(paste(calosc$Data, calosc$Time))
calosc$Date_time <- calosc$Date_time -  minutes(60)
# Ustalamy porę dnia (wieczór/rano)
calosc$godzina <- hour(calosc$Date_time)
calosc$Part_night <- factor(ifelse(calosc$godzina>=12, "wieczor", "rano"))
calosc$Part_night <- relevel(calosc$Part_night, "wieczor")
# Czyścimy tabelę ze zbędnych kolumn
calosc <- select(calosc, kolonia, Season, Phase, Date_time,Channel, Night, Part_night,
Event_V, Toys, Quantity)
# Dodajemy dane o słońcu
calosc$date <- as.Date(calosc$Date_time)
calosc <- left_join(calosc, sun, by ="date" )
calosc <- mutate(calosc,after_dusk = Date_time - sunset,
till_dawn = sunrise - Date_time)
calosc <- u_remove(calosc, slash = F)
calosc <- bs_remove(calosc, slash = F)
calosc <- filter(calosc, Event_V != "")
## Liczymy zdarzenia w obrębie każdego kodu
characters <-c("a","v","c","l","t","o","d","f","w","n","e", "h", "g","r",
"i", "k","q","p")
zdarzenia <- count_instances(calosc, characters)
calosc_zdarzenia <- cbind(calosc, zdarzenia)
# Zamieniamy dane o pogoni na zmienną logiczną
p <- zdarzenia$p
p[is.na(p)] <-0
calosc_zdarzenia$czy_pogon <- as.logical(p)
# ZLiczamy ilość elementów w sekwencji
calosc_zdarzenia$ilosc_elementow <- apply(calosc_zdarzenia[,16:29],1,sum, na.rm = T)
calosc_zdarzenia <- mutate(calosc_zdarzenia,
srednia_ilosc_elementow  = ilosc_elementow/Quantity)
calosc_split <- observation_split(calosc)
# LIczymy poszczególne zdarzenia
characters <-c("a","v","c","l","t","o","d","f","w","n","e", "h", "g","r",
"i", "k","q","p")
zdarzenia <- count_instances(calosc_split, characters)
calosc_split_zdarzenia <- cbind(calosc_split, zdarzenia)
calosc_split_zdarzenia$ilosc_elementow <- apply(calosc_split_zdarzenia[,16:29],1,sum, na.rm = T)
calosc_split_zdarzenia$shannon <- apply(as.matrix(zdarzenia), 1, function(x){
suma <- sum(x, na.rm = T)
prawd <- x/suma
s <- -1 * sum(log(prawd^prawd), na.rm = T)
s
})
hist_act_wiecz <- ggplot(calosc[calosc$Part_night == "wieczor",], aes(x = as.numeric(after_dusk)/60))
hist_act_wiecz + geom_histogram(binwidth = 5) + facet_grid(. ~ Season)
hist_act_rano <- ggplot(calosc[calosc$Part_night == "rano",], aes(x = as.numeric(till_dawn)))
hist_act_rano + geom_histogram(binwidth = 5) + facet_grid(. ~ Season) +
scale_x_continuous(limits = c(0, 150))
hist_act_rano + geom_histogram(binwidth = 5) + facet_grid(kolonia ~ Season) +
scale_x_continuous(limits = c(0, 150))
hist_act_wiecz + geom_histogram(binwidth = 5) + facet_grid(kolonia ~ Season)
hist_act_wiecz + geom_histogram(binwidth = 5) + facet_grid(kolonia ~ .)
hist_act_rano + geom_histogram(binwidth = 5) + facet_grid(kolonia ~ .) +
scale_x_continuous(limits = c(0, 150))
hist_act_wiecz + geom_histogram(binwidth = 5) + facet_grid(kolonia ~ .) +
theme_wesolowski()
hist_act_rano + geom_histogram(binwidth = 5) + facet_grid(kolonia ~ .) +
scale_x_continuous(limits = c(0, 150)) + theme_wesolowski()
hist_act_wiecz + geom_histogram(binwidth = 5) + facet_grid(Season ~ Phase) +
theme_wesolowski()
hist_act_rano + geom_histogram(binwidth = 5) + facet_grid(Season ~ Phase) +
scale_x_continuous(limits = c(0, 150)) + theme_wesolowski()
akt_gg <- ggplot(summary_calosc, aes(y = n_observation, x = Part_night))
akt_gg + geom_boxplot() + facet_grid(kolonia~Season) + theme_wesolowski()
calosc_split_zdarzenia <- group_by(calosc_split_zdarzenia, kolonia, Season, Night, Part_night)
### Liczymy liczbę pościgów i liczbę zdarzeń
summary_calosc <- summarise_each(calosc_split_zdarzenia,
funs(
sum(., na.rm = T)
), vars = -c(1:15))
summary_calosc$n_observation <- summarise(calosc_split_zdarzenia, n_observ = n())$n_observ
# Dodajemy średnie ilości pościgów
summary_calosc <- mutate(summary_calosc, mean_p = p/n_observation)
# Średnie złożoności, czyli średnia ilość elementów w pojedynczej obserwacji
summary_calosc$srednia_sekwencja <- summarise(calosc_split_zdarzenia,
srednia_sekwencja = mean(ilosc_elementow))$srednia_sekwencja
summary_calosc$sredni_shannon <- summarise(calosc_split_zdarzenia,
sredni_shannon = mean(shannon))$sredni_shannon
akt_gg <- ggplot(summary_calosc, aes(y = n_observation, x = Part_night))
akt_gg + geom_boxplot() + facet_grid(kolonia~Season) + theme_wesolowski()
unique(calosc$Channel )
calosc$Channel[calosc$Channel == "Ch1"] <- "ch1"
calosc$Channel[calosc$Channel == "KAM2"] <- "ch2"
calosc$Channel[calosc$Channel == "KAM4"] <- "ch1"
source("functions/observation_split.R")
source("functions/count_instances.R")
source("functions/u_remove.R")
source("functions/bs_remove.R")
source("functions/get_sun.R")
source("functions/wesolowski_plot.R")
sun <- get_sun("input/wschody_zachody_2012.csv")
sun <- tbl_df(sun)
# WCZYTUJEMY OBIE TABELE
jablow <- read.csv2("input/jablow_calosc.csv", as.is = TRUE)
krajanow <- read.csv2("input/krajanow_calosc.csv", as.is = TRUE)
jablow <- tbl_df(jablow)
krajanow <- tbl_df(krajanow)
calosc <- bind_rows(krajanow, jablow)
rm(jablow)
rm(krajanow)
## DOdawanie zmiennej "kolonia"
calosc$Season <- toupper(calosc$Season)
calosc<- separate(calosc,Season, c("kolonia", "Season"), "_")
calosc$Season[calosc$Season == "1"] <- "I"
calosc$Season[calosc$Season == "2"] <- "II"
calosc$Season[calosc$Season == "3"] <- "III"
calosc$Channel[calosc$Channel == "Ch1"] <- "ch1"
calosc$Channel[calosc$Channel == "KAM2"] <- "ch2"
calosc$Channel[calosc$Channel == "KAM4"] <- "ch1"
## Zmieniam daty na format R - patrz lubridate
calosc$Date_time <- dmy_hms(paste(calosc$Data, calosc$Time))
calosc$Date_time <- calosc$Date_time -  minutes(60)
# Ustalamy porę dnia (wieczór/rano)
calosc$godzina <- hour(calosc$Date_time)
calosc$Part_night <- factor(ifelse(calosc$godzina>=12, "wieczor", "rano"))
calosc$Part_night <- relevel(calosc$Part_night, "wieczor")
# Czyścimy tabelę ze zbędnych kolumn
calosc <- select(calosc, kolonia, Season, Phase, Date_time,Channel, Night, Part_night,
Event_V, Toys, Quantity)
# Dodajemy dane o słońcu
calosc$date <- as.Date(calosc$Date_time)
calosc <- left_join(calosc, sun, by ="date" )
calosc <- mutate(calosc,after_dusk = Date_time - sunset,
till_dawn = sunrise - Date_time)
calosc <- u_remove(calosc, slash = F)
calosc <- bs_remove(calosc, slash = F)
calosc <- filter(calosc, Event_V != "")
## Liczymy zdarzenia w obrębie każdego kodu
characters <-c("a","v","c","l","t","o","d","f","w","n","e", "h", "g","r",
"i", "k","q","p")
zdarzenia <- count_instances(calosc, characters)
calosc_zdarzenia <- cbind(calosc, zdarzenia)
# Zamieniamy dane o pogoni na zmienną logiczną
p <- zdarzenia$p
p[is.na(p)] <-0
calosc_zdarzenia$czy_pogon <- as.logical(p)
# ZLiczamy ilość elementów w sekwencji
calosc_zdarzenia$ilosc_elementow <- apply(calosc_zdarzenia[,16:29],1,sum, na.rm = T)
calosc_zdarzenia <- mutate(calosc_zdarzenia,
srednia_ilosc_elementow  = ilosc_elementow/Quantity)
calosc_split <- observation_split(calosc)
# LIczymy poszczególne zdarzenia
characters <-c("a","v","c","l","t","o","d","f","w","n","e", "h", "g","r",
"i", "k","q","p")
zdarzenia <- count_instances(calosc_split, characters)
calosc_split_zdarzenia <- cbind(calosc_split, zdarzenia)
calosc_split_zdarzenia$ilosc_elementow <- apply(calosc_split_zdarzenia[,16:29],1,sum, na.rm = T)
calosc_split_zdarzenia$shannon <- apply(as.matrix(zdarzenia), 1, function(x){
suma <- sum(x, na.rm = T)
prawd <- x/suma
s <- -1 * sum(log(prawd^prawd), na.rm = T)
s
})
shan_plot <- ggplot(calosc_split_zdarzenia, aes(x = Part_night, y = shannon))
shan_plot + geom_boxplot(aes(x = Channel)) + facet_grid(kolonia~Season)
# Grupujemy po sezonach, nocach i porze dnia, żeby potem policzyć sumy dla konkretnych
# zdarzeń
calosc_split_zdarzenia <- group_by(calosc_split_zdarzenia, kolonia, Season, Night, Part_night)
### Liczymy liczbę pościgów i liczbę zdarzeń
summary_calosc <- summarise_each(calosc_split_zdarzenia,
funs(
sum(., na.rm = T)
), vars = -c(1:15))
summary_calosc$n_observation <- summarise(calosc_split_zdarzenia, n_observ = n())$n_observ
# Dodajemy średnie ilości pościgów
summary_calosc <- mutate(summary_calosc, mean_p = p/n_observation)
# Średnie złożoności, czyli średnia ilość elementów w pojedynczej obserwacji
summary_calosc$srednia_sekwencja <- summarise(calosc_split_zdarzenia,
srednia_sekwencja = mean(ilosc_elementow))$srednia_sekwencja
summary_calosc$sredni_shannon <- summarise(calosc_split_zdarzenia,
sredni_shannon = mean(shannon))$sredni_shannon
shan_plot + geom_boxplot(aes(x = Channel)) + facet_grid(Phase~Season)
summary_calosc
summary_calosc_proporcje <- mutate(summary_calosc,
a = a/ilosc_elementow,
v = v/ilosc_elementow,
c = c/ilosc_elementow,
l = l/ilosc_elementow,
t = t/ilosc_elementow,
o = o/ilosc_elementow,
d = d/ilosc_elementow,
f = f/ilosc_elementow,
w = w/ilosc_elementow,
n = n/ilosc_elementow,
e = e/ilosc_elementow,
h = h/ilosc_elementow,
g = g/ilosc_elementow,
r = r/ilosc_elementow
)
View(summary_calosc_proporcje)
boxplot(summary_calosc_proporcje$a)
boxplot(summary_calosc_proporcje$a, summary_calosc_proporcje$v,
summary_calosc_proporcje$c, summary_calosc_proporcje$l,
summary_calosc_proporcje$t, summary_calosc_proporcje$o,
summary_calosc_proporcje$d, summary_calosc_proporcje$f,
summary_calosc_proporcje$f, summary_calosc_proporcje$w,
summary_calosc_proporcje$n, summary_calosc_proporcje$e,
summary_calosc_proporcje$h, summary_calosc_proporcje$g,
summary_calosc_proporcje$r)
shan_plot + geom_boxplot(aes(x = Channel)) + facet_grid(Phase~Season)
pogon_gg + geom_boxplot() + facet_grid(kolonia~Season) + theme_wesolowski()
pogon_gg <- ggplot(summary_calosc, aes(y = mean_p, x = Part_night))
pogon_gg + geom_boxplot() + facet_grid(kolonia~Season) + theme_wesolowski()
pogon_gg + geom_boxplot()
